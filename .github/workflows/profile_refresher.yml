name: Run Python Script and Notify

on:
  schedule:
    # Runs every 5 minutes
    - cron: '*/5 * * * *'
  workflow_dispatch: # Allows you to run it manually as well

jobs:
  build-and-notify:
    runs-on: self-hosted  # ✨ UPDATED: Use your Windows machine
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4  # Latest version

      # ✨ UPDATED: Use system Python instead of setup-python action
      - name: Verify Python installation
        run: |
          python --version
          pip --version

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install selenium webdriver-manager

      - name: Run Python script
        id: script_step
        run: python .github/naukri_profile_refresher.py
        continue-on-error: true # Ensures the next step runs even if this one fails

      - name: Send notification email
        if: always() # This condition ensures the email is sent on success or failure
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          secure: true
          username: ${{ secrets.EMAIL_USER }}
          password: ${{ secrets.EMAIL_PASS }}
          to: ${{ secrets.EMAIL_USER }} # Sends the email to your own address
          from: Self-Hosted Windows Runner <${{ secrets.EMAIL_USER }}>
          subject: "Naukri Profile Refresh: ${{ job.status }}"
          body: |
            The job has completed with status: ${{ job.status }}.
            
            Runner: ${{ runner.name }} (Windows Self-Hosted)
            Machine: ${{ runner.os }}

            View the full logs here:
            ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}